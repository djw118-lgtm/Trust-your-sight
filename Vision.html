<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trust Your Sight - Scanner</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#000; color:#fff; overflow:hidden; }
    .scanner-container { width:100vw; height:100vh; position:relative; }
    #scannerVideo { width:100%; height:100%; object-fit:cover; }
    .overlay { position:absolute; top:0; left:0; right:0; bottom:0; pointer-events:none; }
    .eye-target { position:absolute; top:50%; left:50%; width:120px; height:120px;
      border:3px solid #22c55e; border-radius:50%; transform:translate(-50%,-50%); }
    .eye-target.capturing { border-color:#ef4444; background:rgba(239,68,68,0.2); animation:pulse 0.5s ease-in-out; }
    @keyframes pulse {0%{transform:translate(-50%,-50%) scale(1);}50%{transform:translate(-50%,-50%) scale(1.1);}100%{transform:translate(-50%,-50%) scale(1);} }
    .control-panel { position:absolute; bottom:0; left:0; right:0; background:rgba(0,0,0,0.7);
      padding:10px; display:flex; justify-content:center; gap:10px; }
    .control-btn { background:rgba(255,255,255,0.2); border:none; color:#fff; width:50px; height:50px;
      border-radius:50%; font-size:20px; cursor:pointer; }
    .instruction { position:absolute; top:20px; left:50%; transform:translateX(-50%);
      background:rgba(0,0,0,0.6); padding:10px 20px; border-radius:10px; font-size:16px; font-weight:bold; text-align:center; }
    .progress { position:absolute; top:60px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.6);
      padding:6px 12px; border-radius:8px; font-size:14px; }
    .results { display:none; position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.95);
      text-align:center; padding:40px 20px; overflow-y:auto; }
    .results h2 { color:#22c55e; }
    .results .timestamp { font-size:0.9em; margin-bottom:20px; color:#ccc; }
    .results ul { list-style:none; padding:0; max-width:500px; margin:0 auto; text-align:left; }
    .results li { margin:10px 0; padding:10px; border-radius:6px; }
    .green { background:rgba(34,197,94,0.2); border:1px solid #22c55e; }
    .yellow { background:rgba(234,179,8,0.2); border:1px solid #eab308; }
    .red { background:rgba(239,68,68,0.2); border:1px solid #ef4444; }
    .results .actions { margin-top:30px; }
    .results button { margin:8px; padding:12px 20px; border:none; border-radius:6px; font-size:1em; cursor:pointer; }
    .back { background:#444; color:#fff; }
    .new { background:#22c55e; color:#fff; }
    .share { background:#2563eb; color:#fff; }
    .print { background:#f97316; color:#fff; }
  </style>
</head>
<body>
  <div class="scanner-container">
    <video id="scannerVideo" autoplay muted playsinline></video>
    <div class="overlay">
      <div class="eye-target" id="eyeTarget"></div>
      <div class="instruction" id="instructionText">Preparing scanner‚Ä¶</div>
      <div class="progress" id="progressText"></div>
    </div>
    <div class="control-panel">
      <button class="control-btn" id="switchCamBtn" title="Switch Camera">üîÑ</button>
      <button class="control-btn" id="muteBtn" title="Mute/Unmute">üîä</button>
      <button class="control-btn" id="pauseBtn" title="Pause/Resume">‚è∏Ô∏è</button>
      <button class="control-btn" id="exitBtn" title="Exit">‚ùå</button>
    </div>
    <div class="results" id="results">
      <h2>Demo Scan Results</h2>
      <div class="timestamp" id="timestamp"></div>
      <ul id="resultsList"></ul>
      <div class="actions">
        <button class="back" onclick="window.location.href='index.html'">Back to Start</button>
        <button class="new" onclick="restartScan()">Start Again</button>
        <button class="share" onclick="alert('Share feature coming soon')">Share</button>
        <button class="print" onclick="window.print()">Print / Save PDF</button>
      </div>
      <p style="margin-top:20px; font-size:0.9em; color:#aaa;">
        ‚ö† This demo is not a medical diagnosis. Consult a doctor for real medical advice.<br>
        In the future, medical-grade results will be available here.
      </p>
    </div>
  </div>

  <script>
    let currentPosition = 0;
    let isPaused = false;
    let audioEnabled = true;
    let useFrontCamera = true;
    const positions = [
      "Look straight ahead",
      "Look up",
      "Look up-right",
      "Look right",
      "Look down-right",
      "Look down",
      "Look down-left",
      "Look left",
      "Look up-left"
    ];

    async function initCamera() {
      try {
        const constraints = {
          video: { facingMode: useFrontCamera ? "user" : "environment" }
        };
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        document.getElementById("scannerVideo").srcObject = stream;
      } catch (e) {
        alert("Camera access denied or unavailable.");
      }
    }

    function speak(text) {
      if (!audioEnabled) return;
      const synth = window.speechSynthesis;
      if (synth) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.rate = 0.9;
        synth.speak(utter);
      }
    }

    function nextStep() {
      if (isPaused) return;
      if (currentPosition >= positions.length) { finishScan(); return; }
      const text = positions[currentPosition];
      document.getElementById("instructionText").textContent = text;
      document.getElementById("progressText").textContent = "Position " + (currentPosition+1) + " of " + positions.length;
      speak(text);
      const target = document.getElementById("eyeTarget");
      target.classList.add("capturing");
      setTimeout(() => {
        target.classList.remove("capturing");
        currentPosition++;
        setTimeout(nextStep, 2000);
      }, 2000);
    }

    function finishScan() {
      document.querySelector(".overlay").style.display = "none";
      document.querySelector(".control-panel").style.display = "none";
      showResults();
    }

    function showResults() {
      const resultsEl = document.getElementById("results");
      const list = document.getElementById("resultsList");
      list.innerHTML = "";
      const demoResults = [
        { text:"Retinal vessels appear healthy", class:"green" },
        { text:"Neurological patterns normal", class:"green" },
        { text:"Blood pressure indicators normal", class:"green" },
        { text:"Cardiovascular markers: moderate risk", class:"yellow" },
        { text:"Retinal vessels: mild changes detected", class:"yellow" },
        { text:"Diabetes markers: early signs, consult doctor", class:"yellow" },
        { text:"Retinal vessels: leakage detected", class:"red" },
        { text:"Cardiovascular: high-risk markers", class:"red" },
        { text:"Neurological patterns irregular", class:"red" },
        { text:"Signs of hypertensive retinopathy", class:"yellow" },
        { text:"Glaucoma risk markers detected", class:"yellow" },
        { text:"Macular degeneration indicators", class:"red" }
      ];
      let shuffled = demoResults.sort(() => 0.5 - Math.random());
      let selected = shuffled.slice(0, 6);
      if (selected.filter(r => r.class==="green").length < 2) {
        selected[0] = demoResults[0];
        selected[1] = demoResults[1];
      }
      selected.forEach(r => {
        const li = document.createElement("li");
        li.textContent = r.text;
        li.className = r.class;
        list.appendChild(li);
      });
      const ts = new Date().toLocaleString();
      document.getElementById("timestamp").textContent = "Scan completed: " + ts;
      resultsEl.style.display = "block";
    }

    function restartScan() { window.location.reload(); }

    document.getElementById("switchCamBtn").onclick = () => { useFrontCamera=!useFrontCamera; initCamera(); };
    document.getElementById("muteBtn").onclick = () => {
      audioEnabled=!audioEnabled;
      document.getElementById("muteBtn").textContent = audioEnabled ? "üîä" : "üîá";
    };
    document.getElementById("pauseBtn").onclick = () => {
      isPaused=!isPaused;
      document.getElementById("pauseBtn").textContent = isPaused ? "‚ñ∂Ô∏è" : "‚è∏Ô∏è";
      if (!isPaused) nextStep();
    };
    document.getElementById("exitBtn").onclick = () => { window.location.href="index.html"; };

    window.onload = () => { initCamera(); speak("Starting scan. Please hold steady."); setTimeout(nextStep,2000); };
  </script>
</body>
</html>
