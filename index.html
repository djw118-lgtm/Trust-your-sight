</div>

        <!-- Step 11: Results Section -->
        <div id="resultsSection" class="section">
            <div class="header">
                <div class="logo">‚úÖ</div>
                <div class="app-title">Scan Complete!</div>
                <div class="subtitle">Educational Demo Results</div>
            </div>
            
            <div style="text-align: center; margin: 40px 0;">
                <div style="font-size: 72px; color: #22c55e; margin-bottom: 20px;">‚úì</div>
                <h3>Demo Complete!</h3>
                <p>You have successfully completed the educational eye health scanning demonstration.</p>
            </div>
            
            <div class="success-box">
                <h4>Demo Results Summary:</h4>
                <p>This demonstration showed you how professional retinal scanning works for educational purposes.</p>
                <p style="margin-top: 15px; font-weight: 600;">Remember: This is for educational purposes only. Always consult qualified eye care professionals for actual medical screening.</p>
            </div>
            
            <div class="button-group" style="justify-content: center;">
                <button class="btn-primary" onclick="restartApp()">Start Over</button>
                <button class="btn-secondary" onclick="showMoreInfo()">Learn More</button>
            </div>
        </div>

    </div>

    <script>
        // Global variables
        let currentStep = 'ageVerification';
        let selectedAge = null;
        let selectedAccount = null;
        let stream = null;
        let isScanning = false;
        let isPaused = false;
        let currentPosition = 0;
        let currentEye = 'right';
        let soundEnabled = true;
        let scanningTimeout = null;

        // Complete 9-position scan sequence
        const scanPositions = [
            { text: "Look straight ahead", emoji: "üëÅÔ∏è" },
            { text: "Look up", emoji: "‚¨ÜÔ∏è" },
            { text: "Look to your right", emoji: "‚û°Ô∏è" },
            { text: "Look down", emoji: "‚¨áÔ∏è" },
            { text: "Look to your left", emoji: "‚¨ÖÔ∏è" },
            { text: "Look up and to your right", emoji: "‚ÜóÔ∏è" },
            { text: "Look up and to your left", emoji: "‚ÜñÔ∏è" },
            { text: "Look down and to your left", emoji: "‚ÜôÔ∏è" },
            { text: "Look down and to your right", emoji: "‚ÜòÔ∏è" }
        ];

        // Initialize
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString();

        function nextStep(stepId) {
            document.getElementById(currentStep).classList.remove('active');
            document.getElementById(stepId).classList.add('active');
            currentStep = stepId;
        }

        function previousStep(stepId) {
            document.getElementById(currentStep).classList.remove('active');
            document.getElementById(stepId).classList.add('active');
            currentStep = stepId;
        }

        function selectAge(isOver18) {
            selectedAge = isOver18;
            if (isOver18) {
                document.getElementById('parentalConsent').style.display = 'none';
                document.getElementById('accountSelection').style.display = 'block';
            } else {
                document.getElementById('parentalConsent').style.display = 'block';
                document.getElementById('accountSelection').style.display = 'none';
            }
        }

        function selectAccount(type, element) {
            selectedAccount = type;
            
            // Update radio button
            element.querySelector('input[type="radio"]').checked = true;
            
            // Update visual selection
            document.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            
            // Update display text
            let displayText = '';
            if (type === 'individual') {
                displayText = 'Individual Account - $19.99/month';
            } else if (type === 'family') {
                displayText = 'Family Account - $29.99/month (up to 4 members)';
            } else if (type === 'senior') {
                displayText = 'Senior Account (65+) - $14.99/month';
            }
            
            document.getElementById('selectedAccountDisplay').textContent = displayText;
            document.getElementById('accountTypeSignature').textContent = type.charAt(0).toUpperCase() + type.slice(1);
        }

        function toggleCheck(checkboxId, element) {
            const checkbox = document.getElementById(checkboxId);
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                element.classList.add('selected');
            } else {
                element.classList.remove('selected');
            }
        }

        function proceedToDisclaimer() {
            const checkbox = document.getElementById('welcomeAgree');
            if (!checkbox.checked) {
                alert('Please read and check the agreement to continue.');
                return;
            }
            nextStep('medicalDisclaimers');
        }

        function completeEducation() {
            // Check all required checkboxes
            const required = ['legal1', 'legal2', 'legal3', 'legal4', 'legal5'];
            let allChecked = true;
            
            required.forEach(id => {
                if (!document.getElementById(id).checked) {
                    allChecked = false;
                }
            });
            
            if (!allChecked) {
                alert('Please check all required legal acknowledgments to complete education.');
                return;
            }
            
            nextStep('educationComplete');
        }

        function startScanning() {
            nextStep('instructionsSection');
        }

        function goBack() {
            nextStep('educationComplete');
        }

        function beginScan() {
            nextStep('scanningSection');
            initCamera();
            setTimeout(() => {
                startScanSequence();
            }, 2000);
        }

        // Audio functions with improved timing
        function speak(text, callback = null, delay = 0) {
            if (!soundEnabled) {
                if (callback) setTimeout(callback, 1000);
                return;
            }
            
            // Stop any current speech
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
            }
            
            setTimeout(() => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.8; // Slower speech
                    utterance.pitch = 1.0;
                    utterance.volume = 0.8;
                    
                    utterance.onend = () => {
                        if (callback) {
                            setTimeout(callback, 500); // Brief pause after speech
                        }
                    };
                    
                    window.speechSynthesis.speak(utterance);
                } else {
                    if (callback) setTimeout(callback, 2000);
                }
            }, delay);
        }

        function playBeep(callback = null) {
            if (!soundEnabled) {
                if (callback) setTimeout(callback, 200);
                return;
            }
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
                
                if (callback) {
                    setTimeout(callback, 400);
                }
            } catch (error) {
                console.log('Audio context error:', error);
                if (callback) setTimeout(callback, 400);
            }
        }

        // Camera functions
        async function initCamera() {
            try {
                const constraints = {
                    video: {
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    },
                    audio: false
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('activeScannerVideo');
                video.srcObject = stream;
                
                document.getElementById('scanStatus').textContent = 'Camera ready';
                document.getElementById('scanDetails').textContent = 'Hold phone 6-8 inches from face';
                
                console.log('Camera initialized successfully');
            } catch (error) {
                console.error('Camera initialization error:', error);
                document.getElementById('scanStatus').textContent = 'Camera access required';
                document.getElementById('scanDetails').textContent = 'Please allow camera permissions and refresh';
            }
        }

        function startScanSequence() {
            isScanning = true;
            currentPosition = 0;
            currentEye = 'right';
            
            document.getElementById('scanStatus').textContent = `Scanning ${currentEye.toUpperCase()} eye`;
            document.getElementById('scanDetails').textContent = `Position 1 of 9`;
            document.getElementById('eyeInstruction').textContent = 'Cover your LEFT eye with your hand';
            
            speak("Starting right eye scan. Cover your left eye with your hand.", () => {
                setTimeout(() => {
                    scanNextPosition();
                }, 2000);
            });
        }

        function scanNextPosition() {
            if (!isScanning || isPaused) return;
            
            if (currentPosition < scanPositions.length) {
                const position = scanPositions[currentPosition];
                
                // Update UI
                document.getElementById('positionEmoji').textContent = position.emoji;
                document.getElementById('positionText').textContent = position.text;
                document.getElementById('scanDetails').textContent = `Position ${currentPosition + 1} of 9`;
                
                const eyeInstruction = currentEye === 'right' ? 'Cover your LEFT eye with your hand' : 'Cover your RIGHT eye with your hand';
                document.getElementById('eyeInstruction').textContent = eyeInstruction;
                
                speak(position.text, () => {
                    // Capture position after instruction
                    setTimeout(() => {
                        playBeep(() => {
                            document.getElementById('scanStatus').textContent = `‚úÖ Position ${currentPosition + 1} captured!`;
                            
                            currentPosition++;
                            const totalPositions = currentEye === 'left' ? 18 : 9;
                            const completedPositions = currentPosition + (currentEye === 'left' ? 9 : 0);
                            const progress = (completedPositions / totalPositions) * 100;
                            document.getElementById('progressFill').style.width = progress + '%';
                            
                            // Move to next position
                            setTimeout(() => {
                                if (currentPosition >= 9) {
                                    if (currentEye === 'right') {
                                        switchToLeftEye();
                                    } else {
                                        completeScan();
                                    }
                                } else {
                                    document.getElementById('scanStatus').textContent = `Scanning ${currentEye.toUpperCase()} eye`;
                                    scanNextPosition();
                                }
                            }, 1500);
                        });
                    }, 1000);
                }, 300);
            }
        }

        function switchToLeftEye() {
            currentEye = 'left';
            currentPosition = 0;
            
            document.getElementById('scanStatus').textContent = 'Switching to LEFT eye';
            document.getElementById('scanDetails').textContent = 'Get ready for left eye scan';
            document.getElementById('positionText').textContent = 'Preparing left eye scan...';
            document.getElementById('eyeInstruction').textContent = 'Cover your RIGHT eye with your hand';
            
            speak("Great job! Now we'll scan your left eye. Cover your right eye with your hand.", () => {
                setTimeout(() => {
                    scanNextPosition();
                }, 2000);
            });
        }

        function completeScan() {
            isScanning = false;
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('scanStatus').textContent = 'Scan Complete!';
            document.getElementById('scanDetails').textContent = 'Both eyes scanned successfully';
            document.getElementById('positionText').textContent = 'Processing results...';
            document.getElementById('positionEmoji').textContent = '‚úÖ';
            
            speak("Scan complete! Processing your educational results.", () => {
                setTimeout(() => {
                    showResults();
                }, 2000);
            });
        }

        function showResults() {
            emergencyStopScanning();
            nextStep('resultsSection');
        }

        // Control functions
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundBtn');
            btn.textContent = soundEnabled ? 'üîä' : 'üîá';
            
            if (!soundEnabled && 'speechSynthesis' in window) {
                window.speechSynthesis.cancel();
            }
        }

        function pauseResume() {
            isPaused = !isPaused;
            const btn = document.getElementById('pauseBtn');
            btn.textContent = isPaused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
            
            if (isPaused) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                }
            } else if (isScanning) {
                scanNextPosition();
            }
        }

        function switchCamera() {
            // Camera switching logic would go here
            alert('Camera switching feature coming soon!');
        }

        function exitScan() {
            emergencyStopScanning();
            nextStep('educationComplete');
        }

        function emergencyStopScanning() {
            // Stop all scanning processes immediately
            isScanning = false;
            isPaused = false;
            currentPosition = 0;
            currentEye = 'right';

            // Clear ALL possible timeouts
            if (scanningTimeout) {
                clearTimeout(scanningTimeout);
                scanningTimeout = null;
            }

            // Clear any other timeouts
            for (let i = 1; i < 99999; i++) {
                clearTimeout(i);
            }

            // Stop speech synthesis
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
            }

            // Stop camera stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }

            // Reset video element
            const video = document.getElementById('activeScannerVideo');
            if (video) {
                video.srcObject = null;
            }

            // Reset progress
            document.getElementById('progressFill').style.width = '0%';

            console.log('üõë Emergency stop: All scanning processes terminated');
        }

        function restartApp() {
            emergencyStopScanning();
            
            // Reset all form inputs
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('input[type="radio"]').forEach(rb => rb.checked = false);
            
            // Reset variables
            selectedAge = null;
            selectedAccount = null;
            
            // Hide conditional sections
            document.getElementById('parentalConsent').style.display = 'none';
            document.getElementById('accountSelection').style.display = 'none';
            
            // Show first section
            nextStep('ageVerification');
        }

        function showMoreInfo() {
            alert(`üî¨ Educational Demo Information:

üëÅÔ∏è This demonstration shows how professional retinal scanning works
üìö Real eye health screening requires specialized medical equipment
üè• Always consult qualified ophthalmologists for actual diagnosis
üìñ Learn more about diabetic retinopathy at medical websites

‚ö†Ô∏è Remember: This app is for educational purposes only and cannot diagnose medical conditions.`);
        }

        // Initialize app
        console.log('üéâ Trust Your Sight - Educational Eye Health App Ready!');
    </script>
</body>
</html>
