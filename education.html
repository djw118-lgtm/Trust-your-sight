<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Two-Eye Calibration</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 40px; }
    .card { max-width: 600px; margin: auto; padding: 30px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .instructions { font-size: 1.3em; margin-bottom: 30px; min-height: 100px; }
    button { padding: 12px 24px; font-size: 1.2em; border: none; border-radius: 12px; background: #0078d7; color: white; cursor: pointer; }
    button:disabled { background: gray; }
  </style>
</head>
<body>

<div class="card">
  <div id="step" class="instructions">
    Hold your phone six to eight inches in front of your testing eye.
    Cover the other eye gently with your hand.
    Keep your head still and move only your eyes.
    We will guide you clockwise through the test.
  </div>
  <button id="nextBtn">Begin Calibration</button>
</div>

<script>
const synth = window.speechSynthesis;

// Narration text
const setupText = `Hold your phone six to eight inches in front of your testing eye. 
Cover the other eye gently with your hand. 
Keep your head still and move only your eyes. 
We will guide you clockwise through the test â€” starting straight ahead, then one o'clock, three o'clock, five o'clock, six o'clock, seven o'clock, nine o'clock, eleven o'clock, and twelve o'clock. 
Tap Begin Calibration to start.`;

const calibrationSteps = [
  "Look straight ahead. Hold steady.",
  "Look up-right, one o'clock. Hold steady.",
  "Look right, three o'clock. Hold steady.",
  "Look down-right, five o'clock. Hold steady.",
  "Look down, six o'clock. Hold steady.",
  "Look down-left, seven o'clock. Hold steady.",
  "Look left, nine o'clock. Hold steady.",
  "Look up-left, eleven o'clock. Hold steady.",
  "Look up, twelve o'clock. Hold steady."
];

let stepIndex = -1;
let currentEye = "right"; // start with right eye

function speak(text, callback) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.onend = callback;
  synth.speak(utterance);
}

document.getElementById("nextBtn").addEventListener("click", () => {
  if (stepIndex === -1) {
    // Play setup narration
    speak(setupText, () => {
      document.getElementById("nextBtn").textContent = "Start Right Eye";
    });
    stepIndex = -2; // setup done
  } else if (stepIndex === -2) {
    // Start right eye calibration
    stepIndex = 0;
    runStep();
  } else {
    // Manual advance fallback
    stepIndex++;
    runStep();
  }
});

function runStep() {
  if (stepIndex < calibrationSteps.length) {
    const text = calibrationSteps[stepIndex];
    document.getElementById("step").textContent = `(${currentEye.toUpperCase()} EYE) ${text}`;
    speak(text, () => {
      setTimeout(() => {
        stepIndex++;
        runStep();
      }, 2000);
    });
  } else {
    if (currentEye === "right") {
      // Switch to left eye
      const switchText = `Now cover your right eye gently with your hand. Hold your phone six to eight inches in front of your left eye. Keep your head still and tap Next to continue.`;
      document.getElementById("step").textContent = switchText;
      speak(switchText);
      document.getElementById("nextBtn").textContent = "Start Left Eye";
      stepIndex = -3; // marker for left eye start
      currentEye = "left";
    } else if (stepIndex === -3) {
      // Start left eye calibration
      stepIndex = 0;
      runStep();
    } else {
      // Both eyes done
      const doneText = "Calibration complete. Thank you.";
      document.getElementById("step").textContent = doneText;
      speak(doneText);
      document.getElementById("nextBtn").style.display = "none";
    }
  }
}
</script>

</body>
</html>
